<!DOCTYPE html>
<html>
    <head>
        <title>Makerspace Dashboard</title>
        <link type="text/css" href="mainsite.css" rel="stylesheet">
        <style>
            .sortable:hover {
                cursor: pointer;
            }
            .sortable {
                cursor: pointer;
                background-color: #3d3d3d;
                border: 1px solid #ccc;
                padding: 2px 5px;
                border-radius: 5px;
                transition: background-color 0.3s ease;
            }
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f0f0f0;
            }

            h1 {
                background-color: #333;
                color: #fff;
                padding: 10px 0;
                text-align: center;
            }

            #printerTable {
                width: 100%;
                margin-top: 20px;
                border-collapse: collapse;
            }

            #printerTable th, #printerTable td {
                border: 1px solid #292929;
                padding: 8px;
                text-align: left;
            }
            
            #printerTable tr:nth-child(even) {
                background-color: #c5c4c4;
            }

            #printerTable th {
                background-color: #4CAF50;
                color: white;
            }

            #loading {
                display: none;
                text-align: center;
                padding: 10px 0;
            }

            #searchInput {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                box-sizing: border-box;
            }
        </style>
        <script>
            function searchFunction() {
              // Declare variables
              var input, filter, table, tr, td, i, txtValue;
              input = document.getElementById("searchInput");
              filter = input.value.toUpperCase();
              table = document.getElementById("printerTable");
              tr = table.getElementsByTagName("tr");
            
              // Loop through all table rows, and hide those who don't match the search query
              for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                  txtValue = td.textContent || td.innerText;
                  if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                  } else {
                    tr[i].style.display = "none";
                  }
                }
              }
            }
            function sortTable(n) {
                var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                table = document.getElementById("printerTable");
                switching = true;
                // Set the sorting direction to ascending:
                dir = "asc"; 
                /* Make a loop that will continue until
                no switching has been done: */
                while (switching) {
                    // Start by saying: no switching is done:
                    switching = false;
                    rows = table.rows;
                    /* Loop through all table rows (except the
                    first, which contains table headers): */
                    for (i = 1; i < (rows.length - 1); i++) {
                    // Start by saying there should be no switching:
                    shouldSwitch = false;
                    /* Get the two elements you want to compare,
                    one from current row and one from the next: */
                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];
                    /* Check if the two rows should switch place,
                    based on the direction, asc or desc: */
                    if (dir == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                        }
                    } else if (dir == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                        }
                    }
                    }
                    if (shouldSwitch) {
                    /* If a switch has been marked, make the switch
                    and mark that a switch has been done: */
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    // Each time a switch is done, increase this count by 1:
                    switchcount ++; 
                    } else {
                    /* If no switching has been done AND the direction is "asc",
                    set the direction to "desc" and run the while loop again. */
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                    }
                }
                }
                window.onload = function() {
                    document.getElementById('loading').style.display = 'block';
                    fetch('printers.json')
                    .then(response => response.json())
                    .then(data => {
                        var table = document.getElementById('printerTable');
                        data.forEach(item => {
                            var row = table.insertRow(-1);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            var cell3 = row.insertCell(2);
                            var cell4 = row.insertCell(3);
                            cell1.innerHTML = item.name;
                            cell2.innerHTML = item.type;
                            cell3.innerHTML = '<a href="' + item.address + '" target="_blank">' + item.address + '</a>';
                            cell4.innerHTML = item.status;
                            // Hide loading text
                            document.getElementById('loading').style.display = 'none';
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Hide loading text
                        document.getElementById('loading').style.display = 'none';
                    });
                }
        </script>
    </head>
    <body>
        <hr>
        <h1>Makerspace Dashboard</h1>
        <hr>
        <h2 style="text-decoration: underline; padding-left: 1%;">3D Printere (Brukernavn: Makerspace, Passord: user)</h2>
        <input type="text" id="searchInput" onkeyup="searchFunction()" placeholder="Search for printers...">
        <table id="printerTable">
            <tr><th>Navn <span class="sortable" onclick="sortTable(0)">&darr;</span></th><th>Type <span class="sortable" onclick="sortTable(1)">&darr;</span></th><th>Adresse <span class="sortable" onclick="sortTable(2)">&darr;</span></th><th>Status <span class="sortable" onclick="sortTable(3)">&darr;</span></th></tr>
        </table>
        <div id="loading">Fetching printer data...</div>
    </body>
</html>